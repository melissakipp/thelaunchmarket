version: 1
frontend:
  phases:
    preBuild:
      commands:
        - nvm install 18.18.0
        - nvm use 18.18.0
        # Clear npm cache and remove node_modules
        - npm cache clean --force
        - rm -rf node_modules
        # Install dependencies including TypeScript
        - npm ci
    build:
      commands:
        - |
          echo "Environment Check:"
          echo "NODE_ENV: $NODE_ENV"
          echo "EMAIL_USER exists: $(if [ ! -z "$EMAIL_USER" ]; then echo "YES"; else echo "NO"; fi)"
          echo "EMAIL_PASS exists: $(if [ ! -z "$EMAIL_PASS" ]; then echo "YES"; else echo "NO"; fi)"
        - echo "Starting build process..."
        # Verify TypeScript is installed
        - echo "TypeScript version:" && npx tsc --version
        - npm run build
  artifacts:
    baseDirectory: .next
    files:
      - "**/*"
  cache:
    paths:
      - node_modules/**/*
